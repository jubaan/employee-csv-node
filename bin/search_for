#!/usr/bin/env node

const fs = require('fs');

fs.readFile('./data/employees.csv', 'utf8', (error, data) => { 
    if (error) console.error(error.message);

    const content = data.toString().split('\n').map(line => line.split(','));
    const headers = content[0];
    const rows = content.slice(1, -1);
    const search_attr = process.argv.slice(2) 
    
    let result = rows.map((row) => {
        return row.reduce((key, value, i) => {
            key[headers[i]] = value;
            return key;
        }, {})
    });

    if (search_attr.length < 1) {
        console.log(result);
        return;
    }

    let output = {};

    result.forEach((employee) => {
        for (let prop in employee) {
            if (employee[prop] === search_attr[0]) {
                if (search_attr.length === 1) {
                    output = employee;
                    return;
                }

                search_attr.forEach((attribute) => {
                    output[prop] = employee[prop];

                    for (let prop in employee) {
                        if (prop === attribute) {
                            output[prop] = employee[prop];
                        }
                    }
                })
            }
        }
    })

    console.log(output);
});
